{% extends 'base.html' %}

{% block content %}
<style>
    .plant-box {
        border: 1px solid #ddd;
        padding: 10px;
        margin-bottom: 10px;
        border-radius: 5px;
        background-color: #f9f9f9;
    }
</style>

<div class="container mt-5">
    <h2 class="mb-4">Search for Plants</h2>
    <div class="input-group mb-3">
        <input type="text" id="search-input" class="form-control" placeholder="Type to search for plants..." autocomplete="off">
        <div class="input-group-append">
            <button class="btn btn-outline-secondary" type="button" id="search-button">Search</button>
        </div>
    </div>
    <div id="search-results" class="mt-3"></div>
</div>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script>
    $(document).ready(function() {
        $('#search-button').on('click', function() {
            var query = $('#search-input').val();
    
            if (query) {
                $.ajax({
                    url: '/api/search',
                    data: { q: query },
                    success: function(data) {
                        $('#search-results').empty();
    
                        if (data.error) {
                            $('#search-results').append('<p>Could not fetch the results. Please try again later.</p>');
                        } else if (data.length > 0) {
                            data.forEach(function(plant) {
                                var wateringGuide = plant.watering_guide;
                                var sunlightGuide = plant.sunlight_guide;
                                var pruningGuide = plant.pruning_guide;
    
                                var plantHTML = `<div class="plant-box">
                                    <strong>Common Name:</strong> ${plant.common_name}<br>
                                    <strong>Scientific Name:</strong> ${plant.scientific_name}<br>
                                    <strong>Watering Guide:</strong> ${wateringGuide}<br>
                                    <strong>Sunlight Guide:</strong> ${sunlightGuide}<br>
                                    <strong>Pruning Guide:</strong> ${pruningGuide}<br>
                                </div>`;
                                $('#search-results').append(plantHTML);
                            });
                        } else {
                            $('#search-results').append('<p>No plants found. Try a different search.</p>');
                        }
                    },
                    error: function() {
                        $('#search-results').append('<p>Failed to fetch results.</p>');
                    }
                });
            } else {
                $('#search-results').empty().append('<p>Please enter a search term.</p>');
            }
        });
    });    
</script>
{% endblock %}

